<!DOCTYPE html>
<html lang="zh-HK">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>IG Post é¡§å• | é«˜è½‰åŒ–è²¼æ–‡ç¥å™¨</title>
  <script type="module" src="/_vercel/insights/script.js"></script>
  <meta property="og:title" content="IG Post é¡§å• ğŸ“ˆ é«˜è½‰åŒ–è²¼æ–‡ç¥å™¨">
  <meta property="og:description" content="ç”± Growth Lab HK ç ”ç™¼ â€“ è‡ªå‹•ç”Ÿæˆé«˜è½‰åŒ– IG æ–‡æ¡ˆã€Caption + Hashtag">
  <meta property="og:image" content="https://ig-post-advisor.vercel.app/preview.jpg">
  <meta property="og:url" content="https://ig-post-advisor.vercel.app">
  <meta property="og:type" content="website">
  <meta name="twitter:card" content="summary_large_image">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+HK:wght@400;500;700;900&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family: 'Noto Sans HK', sans-serif; background: #FFFFFF; color: #000000; }
    .hard-shadow { box-shadow: 6px 6px 0px 0px #000000; }
    .hard-shadow-pressed { box-shadow: 3px 3px 0px 0px #000000; }
    .tab-active { background: #000; color: #FFF; }
    mark { background: #000; color: #FFF; padding: 4px 10px; border-radius: 8px; }
    #chatForm { padding-bottom: env(safe-area-inset-bottom, 20px); }
  </style>
</head>
<body class="min-h-screen flex flex-col">

  <!-- Header -->
  <header class="border-b-4 border-black p-6 text-center hard-shadow bg-white">
    <h1 class="text-4xl font-black mb-3 leading-tight">IG Post é¡§å• ğŸš€</h1>
    <p class="text-lg font-medium mb-2">é«˜è½‰åŒ– ğŸ’¡ IG è²¼æ–‡å³åˆ»ç”Ÿæˆ</p>
    <div class="text-xs text-gray-600 space-y-1">
      <p>ç”± Growth Lab HK ç ”ç™¼ï¼Œæœªç¶“æˆæ¬Šä¸å¾—è½‰è¼‰</p>
      <p>æ­¤éä¸€èˆ¬ AI å·¥å…·ï¼Œè€Œæ˜¯é€éå¤§é‡è¨“ç·´ï¼ŒæŒæ¡äº†é«˜è½‰åŒ–çš„æ€ç¶­</p>
    </div>
  </header>

  <!-- 3 å¤§åŠŸèƒ½ Tab -->
  <div class="p-4 bg-white border-b-4 border-black">
    <div class="max-w-4xl mx-auto flex flex-wrap justify-center gap-3">
      <button data-tab="generate" class="tab-btn tab-active px-8 py-4 border-4 border-black rounded-3xl font-black text-xl hard-shadow transition">æ–‡æ¡ˆç”Ÿæˆ</button>
      <button data-tab="review" class="tab-btn px-8 py-4 border-4 border-black rounded-3xl font-black text-xl hard-shadow transition">æ–‡æ¡ˆæ”¹å–„ï¼å¯©æ ¸</button>
      <button data-tab="caption" class="tab-btn px-8 py-4 border-4 border-black rounded-3xl font-black text-xl hard-shadow transition">Caption + Hashtag</button>
    </div>
  </div>

  <!-- å…§å®¹å€åŸŸ -->
  <div id="tab-content" class="flex-1 flex flex-col overflow-hidden">

    <!-- æ–‡æ¡ˆç”Ÿæˆï¼ˆ5 å€‹æ¬„ä½ dropdown + å…¶ä»–è‡ªè¡Œå¡«å¯«ï¼‰ -->
    <section id="generate" class="tab-panel p-4 sm:p-6 bg-white flex-1 flex flex-col">
      <div class="max-w-4xl mx-auto space-y-6 w-full">
        <h2 class="text-2xl font-black text-center">å¿«é€Ÿç”Ÿæˆ IG è²¼æ–‡</h2>

        <!-- ç›®æ¨™å®¢æˆ¶ -->
        <div>
          <label class="block text-lg font-black mb-2">ç›®æ¨™å®¢æˆ¶ <span class="text-red-500">*</span></label>
          <select id="target-select" class="w-full px-6 py-5 border-4 border-black rounded-3xl hard-shadow focus:hard-shadow-pressed transition">
            <option value="28æ­²æœˆå…‰æ—OL">28æ­²æœˆå…‰æ—OL</option>
            <option value="35æ­²ä¸­ç”¢çˆ¸çˆ¸">35æ­²ä¸­ç”¢çˆ¸çˆ¸</option>
            <option value="45æ­²ä¿éšªå¾æ¥­å“¡">45æ­²ä¿éšªå¾æ¥­å“¡</option>
            <option value="25æ­²å¥èº«æ–°æ‰‹">25æ­²å¥èº«æ–°æ‰‹</option>
            <option value="30æ­²ç¾ç”²å¸«">30æ­²ç¾ç”²å¸«</option>
            <option value="50æ­²é€€ä¼‘äººå£«">50æ­²é€€ä¼‘äººå£«</option>
            <option value="28æ­²ä¸Šç­æ—å¥³ç”Ÿ">28æ­²ä¸Šç­æ—å¥³ç”Ÿ</option>
            <option value="35æ­²æ„›ç¾åª½åª½">35æ­²æ„›ç¾åª½åª½</option>
            <option value="å…¶ä»–ï¼ˆè‡ªè¡Œå¡«å¯«ï¼‰">å…¶ä»–ï¼ˆè‡ªè¡Œå¡«å¯«ï¼‰</option>
          </select>
          <input type="text" id="target-custom" placeholder="è«‹è¼¸å…¥ç›®æ¨™å®¢æˆ¶" class="w-full px-6 py-5 border-4 border-black rounded-3xl hard-shadow focus:hard-shadow-pressed transition mt-3 hidden">
        </div>

        <!-- è¡Œæ¥­ï¼ç”¢å“ -->
        <div>
          <label class="block text-lg font-black mb-2">è¡Œæ¥­ï¼ç”¢å“ <span class="text-red-500">*</span></label>
          <select id="product-select" class="w-full px-6 py-5 border-4 border-black rounded-3xl hard-shadow focus:hard-shadow-pressed transition">
            <option value="é«˜æ¯å„²è“„æˆ¶å£">é«˜æ¯å„²è“„æˆ¶å£</option>
            <option value="å¥èº«èª²ç¨‹">å¥èº«èª²ç¨‹</option>
            <option value="ç¾å®¹ç™‚ç¨‹">ç¾å®¹ç™‚ç¨‹</option>
            <option value="å¡”ç¾…å åœ">å¡”ç¾…å åœ</option>
            <option value="é¤Šç”Ÿæ¡ƒè† ">é¤Šç”Ÿæ¡ƒè† </option>
            <option value="é¤Šç”ŸèŠ±èŒ¶">é¤Šç”ŸèŠ±èŒ¶</option>
            <option value="è²»æ´›è’™é¦™æ°´">è²»æ´›è’™é¦™æ°´</option>
            <option value="è‚Œè†šè† åŸå†ç”Ÿç™‚ç¨‹">è‚Œè†šè† åŸå†ç”Ÿç™‚ç¨‹</option>
            <option value="ä¿éšªäººå¸å®¢ç³»çµ±">ä¿éšªäººå¸å®¢ç³»çµ±</option>
            <option value="è±èƒ¸ç”¢å“">è±èƒ¸ç”¢å“</option>
            <option value="é ­é«®è­·ç†ç”¢å“">é ­é«®è­·ç†ç”¢å“</option>
            <option value="è­·è†šç”¢å“">è­·è†šç”¢å“</option>
            <option value="å…¶ä»–ï¼ˆè‡ªè¡Œå¡«å¯«ï¼‰">å…¶ä»–ï¼ˆè‡ªè¡Œå¡«å¯«ï¼‰</option>
          </select>
          <input type="text" id="product-custom" placeholder="è«‹è¼¸å…¥è¡Œæ¥­ï¼ç”¢å“" class="w-full px-6 py-5 border-4 border-black rounded-3xl hard-shadow focus:hard-shadow-pressed transition mt-3 hidden">
        </div>

        <!-- ç—›é» -->
        <div>
          <label class="block text-lg font-black mb-2">ç—›é» <span class="text-red-500">*</span></label>
          <select id="pain-select" class="w-full px-6 py-5 border-4 border-black rounded-3xl hard-shadow focus:hard-shadow-pressed transition">
            <option value="æœˆå°¾ç„¡éŒ¢ä½¿">æœˆå°¾ç„¡éŒ¢ä½¿</option>
            <option value="æ¸›è‚¥åå½ˆ">æ¸›è‚¥åå½ˆ</option>
            <option value="ä¿è²»å¤ªè²´">ä¿è²»å¤ªè²´</option>
            <option value="æµå””åˆ°å¦ä¸€åŠ">æµå””åˆ°å¦ä¸€åŠ</option>
            <option value="äº‹æ¥­è¿·èŒ«">äº‹æ¥­è¿·èŒ«</option>
            <option value="çš®è†šæš—æ²‰">çš®è†šæš—æ²‰</option>
            <option value="å£“åŠ›å¤§">å£“åŠ›å¤§</option>
            <option value="é ­é«®ä¹¾æ¯">é ­é«®ä¹¾æ¯</option>
            <option value="èƒ¸éƒ¨ä¸‹å‚">èƒ¸éƒ¨ä¸‹å‚</option>
            <option value="è† åŸè›‹ç™½æµå¤±">è† åŸè›‹ç™½æµå¤±</option>
            <option value="æ°£è‰²å·®">æ°£è‰²å·®</option>
            <option value="ç¶“å¸¸æ„Ÿå†’">ç¶“å¸¸æ„Ÿå†’</option>
            <option value="å…¶ä»–ï¼ˆè‡ªè¡Œå¡«å¯«ï¼‰">å…¶ä»–ï¼ˆè‡ªè¡Œå¡«å¯«ï¼‰</option>
          </select>
          <input type="text" id="pain-custom" placeholder="è«‹è¼¸å…¥ç—›é»" class="w-full px-6 py-5 border-4 border-black rounded-3xl hard-shadow focus:hard-shadow-pressed transition mt-3 hidden">
        </div>

        <!-- ç«¶çˆ­å°æ‰‹ -->
        <div>
          <label class="block text-lg font-black mb-2">ç«¶çˆ­å°æ‰‹ <span class="text-red-500">*</span></label>
          <select id="competitor-select" class="w-full px-6 py-5 border-4 border-black rounded-3xl hard-shadow focus:hard-shadow-pressed transition">
            <option value="æ™®é€šéŠ€è¡Œ">æ™®é€šéŠ€è¡Œ</option>
            <option value="æ¸›è‚¥App">æ¸›è‚¥App</option>
            <option value="æ˜Ÿåº§é‹ç¨‹">æ˜Ÿåº§é‹ç¨‹</option>
            <option value="å°ˆæ«ƒè­·è†šå“">å°ˆæ«ƒè­·è†šå“</option>
            <option value="å…è²»å åœ">å…è²»å åœ</option>
            <option value="å‚³çµ±ä¿éšª">å‚³çµ±ä¿éšª</option>
            <option value="è¶…å¸‚æ¡ƒè† ">è¶…å¸‚æ¡ƒè† </option>
            <option value="èŒ¶åŒ…èŠ±èŒ¶">èŒ¶åŒ…èŠ±èŒ¶</option>
            <option value="å¹³åƒ¹é¦™æ°´">å¹³åƒ¹é¦™æ°´</option>
            <option value="æ™®é€šç¾å®¹é™¢">æ™®é€šç¾å®¹é™¢</option>
            <option value="å…¶ä»–ï¼ˆè‡ªè¡Œå¡«å¯«ï¼‰">å…¶ä»–ï¼ˆè‡ªè¡Œå¡«å¯«ï¼‰</option>
          </select>
          <input type="text" id="competitor-custom" placeholder="è«‹è¼¸å…¥ç«¶çˆ­å°æ‰‹" class="w-full px-6 py-5 border-4 border-black rounded-3xl hard-shadow focus:hard-shadow-pressed transition mt-3 hidden">
        </div>

        <!-- æœ€çµ‚ç›®æ¨™ -->
        <div>
          <label class="block text-lg font-black mb-2">æœ€çµ‚ç›®æ¨™ <span class="text-red-500">*</span></label>
          <select id="goal-select" class="w-full px-6 py-5 border-4 border-black rounded-3xl hard-shadow focus:hard-shadow-pressed transition">
            <option value="æ¯æœˆå¤š$800è¢«å‹•æ”¶å…¥">æ¯æœˆå¤š$800è¢«å‹•æ”¶å…¥</option>
            <option value="è…¹è‚Œ">è…¹è‚Œ</option>
            <option value="æµåˆ°å¦ä¸€åŠ">æµåˆ°å¦ä¸€åŠ</option>
            <option value="è²¡å‹™è‡ªç”±">è²¡å‹™è‡ªç”±</option>
            <option value="æ°´å…‰è‚Œ">æ°´å…‰è‚Œ</option>
            <option value="äº‹æ¥­æ¸…æ™°">äº‹æ¥­æ¸…æ™°</option>
            <option value="èƒ¸éƒ¨å‡æ¯">èƒ¸éƒ¨å‡æ¯</option>
            <option value="é ­é«®æŸ”é †">é ­é«®æŸ”é †</option>
            <option value="ç”±å…§åˆ°å¤–å¹´è¼• 10 æ­²">ç”±å…§åˆ°å¤–å¹´è¼• 10 æ­²</option>
            <option value="å¢å¼·é­…åŠ›">å¢å¼·é­…åŠ›</option>
            <option value="æå‡è‡ªä¿¡">æå‡è‡ªä¿¡</option>
            <option value="å…¶ä»–ï¼ˆè‡ªè¡Œå¡«å¯«ï¼‰">å…¶ä»–ï¼ˆè‡ªè¡Œå¡«å¯«ï¼‰</option>
          </select>
          <input type="text" id="goal-custom" placeholder="è«‹è¼¸å…¥æœ€çµ‚ç›®æ¨™" class="w-full px-6 py-5 border-4 border-black rounded-3xl hard-shadow focus:hard-shadow-pressed transition mt-3 hidden">
        </div>

        <!-- åƒè€ƒç¶²å€ -->
        <div>
          <label class="block text-lg font-medium text-gray-700 mb-2">åƒè€ƒç¶²å€ï¼ˆå¯é¸ï¼‰</label>
          <input type="url" id="url" placeholder="ä¾‹å¦‚ï¼šhttps://example.com" class="w-full px-6 py-5 border-4 border-black rounded-3xl hard-shadow focus:hard-shadow-pressed transition">
        </div>

<!-- å…§å®¹ç­–ç•¥ï¼ˆåŠ å’—ç¬¬8å€‹ï¼šç›´æ¥éŠ·å”®ï¼ŒåŒå…¶ä»– button å®Œå…¨ä¸€æ¨£è¨­è¨ˆï¼‰ -->
    <div class="space-y-3">
      <label class="block text-lg font-bold">å…§å®¹ç­–ç•¥ï¼ˆè«‹æ€ä¸€å€‹ï¼‰</label>
      <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
        <label class="flex items-center gap-3 cursor-pointer"><input type="radio" name="strategy" value="å“ç‰Œæ•…äº‹" class="w-6 h-6 border-4 border-black hard-shadow"><span class="font-medium">å“ç‰Œæ•…äº‹</span></label>
        <label class="flex items-center gap-3 cursor-pointer"><input type="radio" name="strategy" value="æˆåŠŸæ¡ˆä¾‹" class="w-6 h-6 border-4 border-black hard-shadow"><span class="font-medium">æˆåŠŸæ¡ˆä¾‹</span></label>
        <label class="flex items-center gap-3 cursor-pointer"><input type="radio" name="strategy" value="ç¨ç‰¹æ©Ÿåˆ¶" class="w-6 h-6 border-4 border-black hard-shadow"><span class="font-medium">ç¨ç‰¹æ©Ÿåˆ¶</span></label>
        <label class="flex items-center gap-3 cursor-pointer"><input type="radio" name="strategy" value="ç—›é»æ–‡" class="w-6 h-6 border-4 border-black hard-shadow"><span class="font-medium">ç—›é»æ–‡</span></label>
        <label class="flex items-center gap-3 cursor-pointer"><input type="radio" name="strategy" value="åƒ¹å€¼ç‚¸å½ˆ" class="w-6 h-6 border-4 border-black hard-shadow"><span class="font-medium">åƒ¹å€¼ç‚¸å½ˆ</span></label>
        <label class="flex items-center gap-3 cursor-pointer"><input type="radio" name="strategy" value="å¸¸çŠ¯éŒ¯èª¤" class="w-6 h-6 border-4 border-black hard-shadow"><span class="font-medium">å¸¸çŠ¯éŒ¯èª¤</span></label>
        <label class="flex items-center gap-3 cursor-pointer"><input type="radio" name="strategy" value="å®¢ç¾¤å…§å®¹" class="w-6 h-6 border-4 border-black hard-shadow"><span class="font-medium">å®¢ç¾¤å…§å®¹</span></label>
        <!-- æ–°å¢ï¼šç›´æ¥éŠ·å”®ï¼ˆåŒå…¶ä»–ä¸€æ¨£è¨­è¨ˆï¼Œå†‡ç´…è‰²ï¼‰ -->
        <label class="flex items-center gap-3 cursor-pointer"><input type="radio" name="strategy" value="ç›´æ¥éŠ·å”®" class="w-6 h-6 border-4 border-black hard-shadow"><span class="font-medium">ç›´æ¥éŠ·å”®</span></label>
      </div>
    </div>

        <button id="generateBtn" class="w-full py-5 bg-black text-white font-black text-xl rounded-3xl border-4 border-black hard-shadow hover:hard-shadow-pressed transition">
          ç”Ÿæˆ IG è²¼æ–‡
        </button>

        <!-- é¡§å•èŠå¤©å®¤æç¤º -->
        <div class="my-10 text-center">
          <p class="text-2xl font-black inline-flex items-center gap-4">
            â¬‡ï¸ é¡§å•èŠå¤©å®¤ â¬‡ï¸
          </p>
          <p class="text-lg text-gray-700 mt-3">ç”Ÿæˆå®Œå¯ä»¥ç¹¼çºŒåŒæˆ‘å‚¾è¨ˆã€æ”¹æ–‡æ¡ˆã€åŠ ä¾‹å­ã€å•å•é¡Œï½</p>
        </div>
      </div>
    </section>

    <!-- æ–‡æ¡ˆæ”¹å–„ï¼å¯©æ ¸ -->
    <section id="review" class="tab-panel p-6 bg-white flex-1 hidden">
      <div class="max-w-4xl mx-auto space-y-6">
        <h2 class="text-3xl font-black text-center">æ–‡æ¡ˆæ”¹å–„ï¼å¯©æ ¸</h2>
        <p class="text-center text-lg">è²¼ä½ æˆ–è€…ä½ å®¢æˆ¶å¯«å¥½å˜…æ–‡æ¡ˆå…¥åšŸï¼Œæˆ‘æœƒé€å¥åˆ†æ + ç•€æ”¹é€²ç‰ˆ</p>
        <textarea id="reviewText" rows="10" placeholder="è²¼ä½ å˜…æ–‡æ¡ˆå…¥åšŸâ€¦" class="w-full px-6 py-5 border-4 border-black rounded-3xl hard-shadow focus:hard-shadow-pressed transition text-base"></textarea>
        <button id="reviewBtn" class="w-full py-5 bg-black text-white font-black text-xl rounded-3xl border-4 border-black hard-shadow hover:hard-shadow-pressed transition">
          é–‹å§‹å¯©æ ¸
        </button>
      </div>
    </section>

    <!-- Caption + Hashtag -->
    <section id="caption" class="tab-panel p-6 bg-white flex-1 hidden">
      <div class="max-w-4xl mx-auto space-y-8">
        <h2 class="text-3xl font-black text-center">Caption + Hashtag ä¸€éµç”Ÿæˆ</h2>
        <div class="text-center">
          <button id="captionFromFormBtn" class="px-10 py-5 bg-black text-white font-black text-xl rounded-3xl border-4 border-black hard-shadow hover:hard-shadow-pressed transition">
            ç”¨ä¹‹å‰å¡«å˜…è³‡æ–™ç”Ÿæˆ 2 çµ„ Caption
          </button>
        </div>
        <div class="text-center text-2xl font-bold my-8">æˆ–è€…</div>
        <div class="space-y-4">
          <label class="block text-lg font-bold text-center">è²¼å®Œæ•´æ–‡æ¡ˆç”Ÿæˆ Caption</label>
          <textarea id="captionText" rows="8" placeholder="è²¼ä½ å¯«å¥½å˜…å®Œæ•´æ–‡æ¡ˆå…¥åšŸâ€¦" class="w-full px-6 py-5 border-4 border-black rounded-3xl hard-shadow focus:hard-shadow-pressed transition text-base"></textarea>
          <button id="captionFromTextBtn" class="w-full py-5 bg-black text-white font-black text-xl rounded-3xl border-4 border-black hard-shadow hover:hard-shadow-pressed transition">
            å¾æ–‡æ¡ˆç”Ÿæˆ 2 çµ„ Caption + Hashtag
          </button>
        </div>
      </div>
    </section>

   <!-- èŠå¤©å®¤ + åº•éƒ¨è¼¸å…¥æ¡†ï¼ˆä¿ç•™ï¼‰ -->
    <main id="messages" class="flex-1 overflow-y-auto px-4 pt-6 pb-2 bg-[#F3F4F6] space-y-5"></main>
    <form id="chatForm" class="bg-white border-t-4 border-black hard-shadow">
      <div class="p-4 max-w-5xl mx-auto">
        <div class="flex flex-col sm:flex-row gap-3">
          <textarea id="userInput" rows="1" placeholder="æˆ–è€…ç›´æ¥åŒæˆ‘å‚¾è¨ˆâ€¦" class="flex-1 px-6 py-4 text-base sm:text-lg border-4 border-black rounded-3xl resize-none focus:outline-none focus:hard-shadow-pressed transition-all min-h-12 max-h-32" style="field-sizing: content;"></textarea>
          <button type="submit" class="px-8 py-4 bg-black text-white font-black text-lg sm:text-xl rounded-3xl border-4 border-black hard-shadow hover:hard-shadow-pressed transition-all whitespace-nowrap">å‚³é€</button>
        </div>
      </div>
    </form>

    <script>
      // Tab åˆ‡æ›
      document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('tab-active'));
          document.querySelectorAll('.tab-panel').forEach(p => p.classList.add('hidden'));
          btn.classList.add('tab-active');
          document.getElementById(btn.dataset.tab).classList.remove('hidden');
        });
      });

      const messagesDiv = document.getElementById('messages');
      const chatForm = document.getElementById('chatForm');
      const userInput = document.getElementById('userInput');
      const generateBtn = document.getElementById('generateBtn');
      const reviewBtn = document.getElementById('reviewBtn');
      const captionFromFormBtn = document.getElementById('captionFromFormBtn');
      const captionFromTextBtn = document.getElementById('captionFromTextBtn');
      let messageHistory = [];

      // è¶…éš loading æ€è€ƒéç¨‹
      const THINKING_STEPS = [
        "åˆ†æç›®æ¨™å®¢æˆ¶å¿ƒç†â€¦",
        "æµç·Šæœ€ç—›å˜…ç—›é»â€¦",
        "é…ç·Šæœ€çˆ†æˆåŠŸæ¡ˆä¾‹â€¦",
        "åº¦èº«è¨‚é€ ç¨ç‰¹æ©Ÿåˆ¶â€¦",
        "å¯«ç·Šçµå°¾è¶…å¼· CTAâ€¦",
        "åŠ ç·Šæœ€ä½³ Hashtag çµ„åˆâ€¦",
        "æº–å‚™é€å‡ºï¼"
      ];

      function addMessage(content, isBot = false) {
        const div = document.createElement('div');
        div.className = `hard-shadow p-5 sm:p-6 rounded-3xl border-4 border-black max-w-full sm:max-w-2xl ${isBot ? 'bg-white' : 'bg-black text-white ml-auto'}`;
        if (isBot) {
          const formatted = content
            .replace(/\n\n/g, '</p><p>')
            .replace(/\n/g, '<br>')
            .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
            .replace(/ã€(.*?)ã€‘/g, '<mark>$1</mark>');
          div.innerHTML = `<p class="text-base sm:text-lg leading-relaxed">${formatted}</p>`;
        } else {
          div.innerHTML = `<p class="text-base sm:text-lg font-bold text-right leading-relaxed">${content}</p>`;
        }
        messagesDiv.appendChild(div);
        messagesDiv.scrollTop = messagesDiv.scrollHeight;
      }

      async function sendMessage(msg) {
        addMessage(msg, false);
        const loadingBox = document.createElement('div');
        loadingBox.className = 'hard-shadow p-6 rounded-3xl border-4 border-black bg-white max-w-full sm:max-w-2xl';
        loadingBox.innerHTML = `<p class="font-bold text-lg mb-4">æ­£åœ¨å¹«ä½ ç”Ÿæˆé«˜è½‰åŒ–è²¼æ–‡â€¦</p><div class="space-y-3 text-base"></div>`;
        const stepsDiv = loadingBox.querySelector('div');
        messagesDiv.appendChild(loadingBox);
        messagesDiv.scrollTop = messagesDiv.scrollHeight;

        for (let i = 0; i < THINKING_STEPS.length; i++) {
          const step = document.createElement('p');
          step.innerHTML = THINKING_STEPS[i];
          stepsDiv.appendChild(step);
          messagesDiv.scrollTop = messagesDiv.scrollHeight;
          await new Promise(r => setTimeout(r, 1400 + Math.random() * 600));
        }

        messageHistory.push({ role: 'user', content: msg });
        const res = await fetch('/api/chat', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ message: msg, history: messageHistory })
        });

        loadingBox.remove();
        const data = await res.json();
        const reply = data.reply || 'ï¼ˆç”Ÿæˆå¤±æ•—ï¼Œå†è©¦å¤šæ¬¡å•¦ï¼‰';
        addMessage(reply, true);
        messageHistory.push({ role: 'assistant', content: reply });
      }

      // æ–‡æ¡ˆç”Ÿæˆ
      generateBtn.addEventListener('click', () => {
        const fields = {
          target: document.getElementById('target-select').value === 'å…¶ä»–ï¼ˆè‡ªè¡Œå¡«å¯«ï¼‰' ? document.getElementById('target-custom').value.trim() : document.getElementById('target-select').value,
          product: document.getElementById('product-select').value === 'å…¶ä»–ï¼ˆè‡ªè¡Œå¡«å¯«ï¼‰' ? document.getElementById('product-custom').value.trim() : document.getElementById('product-select').value,
          pain: document.getElementById('pain-select').value === 'å…¶ä»–ï¼ˆè‡ªè¡Œå¡«å¯«ï¼‰' ? document.getElementById('pain-custom').value.trim() : document.getElementById('pain-select').value,
          competitor: document.getElementById('competitor-select').value === 'å…¶ä»–ï¼ˆè‡ªè¡Œå¡«å¯«ï¼‰' ? document.getElementById('competitor-custom').value.trim() : document.getElementById('competitor-select').value,
          goal: document.getElementById('goal-select').value === 'å…¶ä»–ï¼ˆè‡ªè¡Œå¡«å¯«ï¼‰' ? document.getElementById('goal-custom').value.trim() : document.getElementById('goal-select').value,
          url: document.getElementById('url').value.trim(),
          strategy: document.querySelector('input[name="strategy"]:checked')?.value
        };

        if (!fields.target || !fields.product || !fields.pain || !fields.competitor || !fields.goal || !fields.strategy) {
          alert('è«‹å¡«æ™’æ‰€æœ‰å¿…å¡«é …ç›®åŒæ€ä¸€å€‹å…§å®¹ç­–ç•¥ï¼');
          return;
        }

        let msg = `ç›®æ¨™å®¢æˆ¶ï¼š${fields.target}\nè¡Œæ¥­ï¼ç”¢å“ï¼š${fields.product}\nç—›é»ï¼š${fields.pain}\nç«¶çˆ­å°æ‰‹ï¼š${fields.competitor}\næœ€çµ‚ç›®æ¨™ï¼š${fields.goal}`;
        if (fields.url) msg += `\nåƒè€ƒç¶²å€ï¼š${fields.url}`;
        msg += `\næˆ‘æƒ³ç”¨å…§å®¹ç­–ç•¥ï¼š${fields.strategy}`;

        // å„²å­˜åˆ° localStorage
        localStorage.setItem('igPostAdvisorSavedInputs', JSON.stringify(fields));

        sendMessage(msg);
      });

      // æ–‡æ¡ˆæ”¹å–„
      reviewBtn.addEventListener('click', () => {
        const text = document.getElementById('reviewText').value.trim();
        if (!text) return alert('è«‹è²¼å…¥ä½ è¦å¯©æ ¸å˜…æ–‡æ¡ˆï¼');
        sendMessage(`è«‹å¹«æˆ‘å°ˆæ¥­å¯©æ ¸å‘¢æ®µ IG æ–‡æ¡ˆï¼Œé€å¥åˆ†æè½‰åŒ–ç‡å•é¡Œï¼Œä¸¦ç•€å‡ºå®Œæ•´æ”¹é€²ç‰ˆï¼ˆ600+å­—ï¼‰:\n\n${text}`);
      });

            // Caption æ–¹å¼1ï¼šç”¨ä¹‹å‰å¡«å˜…è³‡æ–™ç”Ÿæˆ 2 çµ„ Caption
      captionFromFormBtn.addEventListener('click', () => {
        const fields = {
          target: document.getElementById('target').value.trim(),
          product: document.getElementById('product').value.trim(),
          pain: document.getElementById('pain').value.trim(),
          competitor: document.getElementById('competitor').value.trim(),
          goal: document.getElementById('goal').value.trim()
        };
        if (!fields.target || !fields.product) {
          alert('è«‹è‡³å°‘å¡«ç›®æ¨™å®¢æˆ¶åŒè¡Œæ¥­ï¼ç”¢å“ï¼');
          return;
        }
        sendMessage(`è«‹æ ¹æ“šä»¥ä¸‹è³‡æ–™ï¼Œç”Ÿæˆ 2 çµ„ä¸åŒé¢¨æ ¼ã€æ¯çµ„ç´„ 300 å­—å˜…é«˜è½‰åŒ– Captionï¼ˆæ¯çµ„çµå°¾é…å¥½ 10â€“12 å€‹ç²¾æº– hashtagï¼‰ï¼š
ç›®æ¨™å®¢æˆ¶ï¼š${fields.target}
è¡Œæ¥­ï¼ç”¢å“ï¼š${fields.product}
ç—›é»ï¼š${fields.pain}
ç«¶çˆ­å°æ‰‹ï¼š${fields.competitor}
æœ€çµ‚ç›®æ¨™ï¼š${fields.goal}`);
      });

      // Caption æ–¹å¼2ï¼šè²¼å®Œæ•´æ–‡æ¡ˆç”Ÿæˆ 2 çµ„ Caption
      captionFromTextBtn.addEventListener('click', () => {
        const text = document.getElementById('captionText').value.trim();
        if (!text) {
          alert('è«‹è²¼å…¥å®Œæ•´æ–‡æ¡ˆï¼');
          return;
        }
        sendMessage(`è«‹å°‡ä»¥ä¸‹å®Œæ•´æ–‡æ¡ˆæ¿ƒç¸®æˆ 2 çµ„ä¸åŒé¢¨æ ¼ã€æ¯çµ„ç´„ 300 å­—å˜…é«˜è½‰åŒ– Captionï¼ˆä¿ç•™é—œéµè©ï¼‹çµå°¾é…å¥½ 10â€“12 å€‹ç²¾æº– hashtagï¼‰ï¼š

${text}`);
      });

      // èŠå¤©æ¡†
      chatForm.addEventListener('submit', e => {
        e.preventDefault();
        const msg = userInput.value.trim();
        if (msg) {
          sendMessage(msg);
          userInput.value = '';
          userInput.style.height = 'auto';
        }
      });
// é–‹å ´ + è¼‰å…¥ä¸Šæ¬¡è¼¸å…¥
      setTimeout(() => {
        addMessage(`å“ˆå›‰ï¼æˆ‘æ˜¯ä½ å˜… IG Post é¡§å•\n\nè€Œå®¶æœ‰ 3 å¤§åŠŸèƒ½ç•€ä½ ç”¨ï½\nç­‰ç·Šä½ å‘€ï¼`, true);

        // è‡ªå‹•å¡«å…¥ä¸Šæ¬¡å„²å­˜å˜…è³‡æ–™
        const saved = localStorage.getItem('igPostAdvisorSavedInputs');
        if (saved) {
          const data = JSON.parse(saved);
          document.getElementById('target-select').value = data.target || '';
          document.getElementById('product-select').value = data.product || '';
          document.getElementById('pain-select').value = data.pain || '';
          document.getElementById('competitor-select').value = data.competitor || '';
          document.getElementById('goal-select').value = data.goal || '';
          document.getElementById('url').value = data.url || '';
          if (data.strategy) {
            const radio = document.querySelector(`input[name="strategy"][value="${data.strategy}"]`);
            if (radio) radio.checked = true;
          }
          // è¼‰å…¥è‡ªè¨‚è¼¸å…¥æ¡†ï¼ˆå¦‚æœä¸Šæ¬¡ä¿‚ã€Œå…¶ä»–ã€ï¼‰
          ['target', 'product', 'pain', 'competitor', 'goal'].forEach(field => {
            const select = document.getElementById(field + '-select');
            const custom = document.getElementById(field + '-custom');
            if (select.value === 'å…¶ä»–ï¼ˆè‡ªè¡Œå¡«å¯«ï¼‰') {
              custom.classList.remove('hidden');
              custom.value = data[field] || '';
            }
          });
        }
      }, 500);

      // â† å–ºå‘¢åº¦ä¸‹é¢è²¼æˆ‘ç•€ä½ å˜…ã€Œè‡ªå‹•é¡¯ç¤ºè‡ªè¨‚è¼¸å…¥æ¡†ã€code
      // è‡ªå‹•é¡¯ç¤ºè‡ªè¨‚è¼¸å…¥æ¡†
      ['target', 'product', 'pain', 'competitor', 'goal'].forEach(field => {
        const select = document.getElementById(field + '-select');
        const custom = document.getElementById(field + '-custom');

        select.addEventListener('change', () => {
          if (select.value === 'å…¶ä»–ï¼ˆè‡ªè¡Œå¡«å¯«ï¼‰') {
            custom.classList.remove('hidden');
            custom.focus();
          } else {
            custom.classList.add('hidden');
            custom.value = '';
          }
        });
      });

    </script>
  </body>
</html>







